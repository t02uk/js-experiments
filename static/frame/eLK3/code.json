{"source":{"css":"body { background-color: #000000; margin: 0px; overflow: hidden; }","html":"<canvas id='world'></canvas>","lisence":"MIT","js":"// 関数型言語、分からない\n\n(function() {\n\n  var main = function() {\n    \n    // load audio\n    var instruments =\n    $R(0, 7 * 4 - 1).map(function(i) {\n      var serverPath = \"http://dl.dropbox.com/u/3589634/resource/se\";\n      var id = \"sp\";\n      pitch = \"cdefgab\".charAt(i % 7);\n      var audio = new Audio(serverPath + \"/\" + id + \"_\" + pitch + \".\" + \"ogg\");\n      audio.load();\n      return audio;\n    });\n\n    // Create DCore\n    var d = new DCore().init();\n    \n    \n    // polygon, the master of some shape\n    var polygon = function(n, step) {\n      d.quads(\n        $R(0, n - 1).map(function(i) {\n          return [Math.cos((i * step / n).toRadian()),\n                  Math.sin((i * step / n).toRadian())];\n        })\n      ).stroke();\n    };\n    \n    // generate shapes\n    var square = polygon.curry(4, 1);\n    var triangle = polygon.curry(3, 1);\n    var star = polygon.curry(5, 2);\n    var line = polygon.curry(2, 1);\n    var circle = function(radius, p) {\n      d.circle([0.0, 0.0], 1.0).stroke();\n    };\n    \n    \n    // counter\n    var counter = function(max) {\n      var count = 0;\n      return function() {\n        if(count >= max) return null;\n        count++;\n        return count;\n      };\n    };\n    \n    // ripple launcher\n    var rippleLauncher = function(x, y, c, axis, drawer) {\n      return function(count) {\n        var size = count / 12.0;\n        var rad = axis + count / 15.0;\n        d\n         .blend(\"lighter\")\n         .alpha(0.6)\n         .rgb(c[0], c[1], c[2])\n         .tsr([x, y])([size, size])(rad)\n         .lineWidth(0.06 / size)\n        ;\n        drawer();\n        d.reset()\n        ;\n      };\n    };\n    \n    // random actor\n    function RandomActor() {\n      this.seq = 0;\n      return this;\n    }\n    RandomActor.items = [];\n    RandomActor.registor = function(e) {\n      this.seq++; this.seq &= 63;\n      this.items[this.seq] = e;\n    };\n    RandomActor.act = function(e) {\n      for(var i = 0; i < this.items.length; i++) {\n        if(!this.items[i]) continue;\n        this.items[i]();\n      }\n    };\n \n    \n    var instSeq = 0;\n\n    // observe mouse click, and handle it\n    window.px = 0.0;\n    window.py = 0.0;\n    document.addEventListener(\"click\", function(e) {\n      px = e.clientX / d.width - d.left2d;\n      py = e.clientY / d.height - d.top2d;\n      \n      inst = ~~(1.0 - py * 7) + instSeq;\n      instSeq += 7;\n      instSeq %= 4 * 7;\n      if(instruments[inst]) instruments[inst].play();\n      \n      // add ripple\n      RandomActor.registor(\n        (function() {\n          var shapes = [\n            square,\n            triangle,\n            //star,\n            line,\n            circle\n          ];\n          var shape = shapes[~~(Math.random() * shapes.length)];\n\n          var thisCounter = counter(35);\n          var axis = Math.random().toRadian();\n          var x = px;\n          var y = py;\n          return function() {\n            return [\n              thisCounter,\n              rippleLauncher(\n                x,\n                y,\n                [0x66, 0xff, 0xcc],\n                axis,\n                shape\n              )\n            ].andThen();\n          };\n        })(), false);\n    }, false);\n    \n    (function() {\n      // clear back ground\n      d.rgb(10, 15, 15)\n        .alpha(1.0)\n        .blend(\"source-over\")\n        .fillBack();\n\n      RandomActor.act();\n      \n      window.setTimeout(arguments.callee, 33);\n    })();\n  };\n  \n  try {\n    main();\n  } catch(e) {\n//    alert(\"Error:\" + e.message);\n    throw e;\n  }\n})();\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/e/L/K/eLK3_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/e/L/K/eLK3.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/e/L/K/eLK3_100.jpg"},"description_html":"この楽器　<a  href=\"http://www.youtube.com/watch?v=_1p_RI6dG5k\">http://www.youtube.com/watch?v=_1p_RI6dG5k</a>","modified_date":"2010-11-14 19:34:54","uid":"eLK3","created_date":"2010-09-22 17:21:30","path":"eLK3","description":"この楽器　http://www.youtube.com/watch?v=_1p_RI6dG5k","statistic":{"forked":"2","favorite":"0","pageview":"1880"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/eLK3","title":"あの楽器"}