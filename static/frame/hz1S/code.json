{"source":{"css":"body { background-color: #000000; margin: 0px; overflow: hidden; }","html":"<canvas id='world'></canvas>","lisence":"MIT","js":"window.onload = (function() {\n\n  var d = new DCore();\n\n  var c = 2200;\n  var main = function() {\n\n    // random generator\n    var random = function() {\n      var x = 1;\n      return function() {\n        x = (x * 22695477 + 1) & 0xffffffff;\n        return (x >> 16) & 0x7fff;\n      };\n    }();\n\n\n    // set camera\n    var cp, cg;\n    (function() {\n      cp = function() {\n        var s = 0.01;\n        var r = 500 * Math.cos(s * c * 0.1 + 1);\n        var cx = r * Math.sin(s * c - 0.2);\n        var cy = -r * Math.sin(s * c * 0.3) * 0.45 + r * 0.5;\n        cy *= r / r.abs();\n        var cz = r * Math.cos(s * c);\n        return [cx, cy, cz];\n      }();\n      d\n       .gazeFrom(\n        cp,\n        cg = [100, 200, 1]\n       );\n    })();\n\n    var suns = [\n      [0,  8000, -20000],\n      //[0,  6000,  20000],\n      [0, 22000,  1000],\n    ];\n\n    var dots = suns.map(function(sun) {\n      var scgp = cg.sub(cp);\n      return scgp.dot(sun) / sun.distance([0, 0, 0]) / scgp.distance([0, 0, 0])\n    });\n    var dot = dots.max();\n\n    // draw background\n    (function() {\n      d\n       .blend(\"source-over\")\n       .alpha(1)\n      ;\n\n      var cc = Math.pow(dot, 8) * 140;\n      var ad = [cc, cc, cc * 1.2];\n\n      var hy = d.toWorld2d(cp.scale([-10000, 0, -10000]))[1];\n\n      // sky\n      if(hy > 0) {\n        d\n         .alpha(1.0)\n         .rgb([0x22, 0x22, 0x44].add(ad))\n         .quads([\n           [0.0, 0.0],\n           [1.0, 0.0],\n           [1.0, hy],\n           [0.0, hy]\n         ]).fill()\n        ;\n      }\n      // water\n      if(hy < 1) {\n        d\n         .alpha(1.0)\n         .rgb([0x2f, 0x2c, 0x55].add(ad))\n         .quads([\n           [0.0, hy],\n           [1.0, hy],\n           [1.0, 1.0],\n           [0.0, 1.0]\n         ]).fill()\n        ;\n      }\n    })();\n\n    suns.zip(dots).each(function(e) {\n      var sun = e[0];\n      var dot = e[1];\n      // draw sun\n      d\n       .blend(\"lighter\")\n       .alpha(1.0)\n       .luminous(sun, 200.0, 2000.0, [\n           [0,    [0xee, 0xee, 0xee]],\n           [0.15, [0x99, 0xcc, 0xee]],\n           [0.60, [0x22, 0x22, 0x22]],\n           [1,    [0x00, 0x00, 0x00]]\n       ])\n       .fill()\n      ;\n\n      // draw sun (reflection)\n      d\n       .blend(\"lighter\")\n       .alpha(0.1)\n       .luminous(sun.scale(1, -1, 1), 200.0, 2000.0, [\n           [0,    [0xff, 0xff, 0xff]],\n           [0.15, [0x99, 0xee, 0xee]],\n           [0.60, [0x33, 0x66, 0x66]],\n           [0.65, [0x11, 0x11, 0x11]],\n           [1,    [0x00, 0x00, 0x00]]\n       ])\n       .fill()\n      ;\n\n      // lens flare\n      for(var i = 1; i < 12; i++) {\n        var p = sun.mul((6 - i) / 8);\n        var h = (random() % 255) / 255;\n        if(dot > 0.5) {\n          var a = [0, Math.pow(dot, 9) * 0.7 - 0.1, 1].sort()[1];\n          d\n           .blend(\"lighter\")\n           .alpha(a)\n           .luminous(p, 100.0, 400.0, [\n               [1,    [h, 0.9, 0.1].hsv()],\n               [0.9,  [h, 0.8, 0.9].hsv()],\n               [0.7,  [h, 0.6, 0.2].hsv()],\n               [0.0,  [h, 0.3, 0.1].hsv()],\n           ])\n           .fill()\n          ;\n        }\n      }\n    });\n\n\n    // draw luminous on water\n    for(var i = 0; i < 150; i++) {\n      var x = random() % 4000 - 2000;\n      var z = random() % 4000 - 2000;\n      var dist = [0, 0, 0].distance([x, 0, z]);\n      var cdist = [0, 0, 0].distance([x, 0, z]);\n      var y = Math.sin(c / 10 + dist / 300) * 10;\n      var a = [0, 1 / cdist * 300, 1].sort()[1];\n\n      d\n       .blend(\"lighter\")\n       .alpha(a)\n       .luminous([x, y, z], 1.0, 5.0, [\n           [0,    [0xee, 0xee, 0xee]],\n           [0.05, [0xcc, 0xcc, 0xee]],\n           [0.20, [0x22, 0x22, 0x22]],\n           [1,    [0x00, 0x00, 0x00]]\n       ])\n       .fill()\n    }\n\n    // draw stars\n    for(var i = 0; i < 50; i++) {\n      var p = [0, 10000, 0]\n       .rotatex((random() / 0x7fff) * 1.4)\n       .rotatey(random())\n      ;\n\n      var r = (random() / 0x7fff) * 10 + 10;\n\n      d\n       .blend(\"lighter\")\n       .alpha(0.5)\n       .luminous(p, r, r * 8, [\n           [0,    [0xee, 0xee, 0xee]],\n           [0.05, [0x99, 0x99, 0xcc]],\n           [0.20, [0x22, 0x22, 0x22]],\n           [1,    [0x00, 0x00, 0x00]]\n       ])\n       .fill()\n    }\n\n    //window.setTimeout(arguments.callee.curry(c + 1), 33);\n    c++;\n    if(c % 50 === 0) console.log(c);\n  };\n\n\n\n  window.setInterval(main, 33);\n  //main(0);\n});\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/h/z/1/hz1S_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/h/z/1/hz1S.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/h/z/1/hz1S_100.jpg"},"description_html":"夜凪。<br />\n<br />\nFirefoxとかすこぶる重いので、Chrome推奨。","modified_date":"2011-08-28 02:07:51","uid":"hz1S","created_date":"2011-08-28 01:52:03","path":"hz1S","description":"夜凪。\n\nFirefoxとかすこぶる重いので、Chrome推奨。","statistic":{"forked":"2","favorite":"1","pageview":"2014"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/hz1S","title":"yonagi"}