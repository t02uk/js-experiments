{"source":{"css":"body {\n  overflow: hidden;\n  background-image: -webkit-gradient(\n      radial,\n      center center, 0,\n      center center, 5,\n      from(          rgba(160, 160, 255, 1)),\n      color-stop(.99,rgba(160, 160, 255, 1)),\n      to(            rgba(220, 220, 240, 1)));\n  -webkit-background-size: 32px 32px;\n}\n\n\n* {\n    padding: 0px;\n    margin: 0px;\n    position: absolute;\n}\n\nvideo {\n    visibility: hidden;\n}\n\ncanvas {\n    left: 30px;\n    top: 20px;\n    background: #ccf;\n    width: 410px;\n    height: 400px;\n    padding: 0px;\n    margin: 0px;\n    box-shadow: 4px 4px 4px 4px #666;\n}\n\n#message_input {\n    left: 30px;\n    top: 435px;\n    width: 410px;\n    background: -webkit-gradient(linear, left top, left bottom, from(#ddd), to(#fff));\n    text-shadow: 0 1px #ccf;\n    border-radius: 3px;\n}\n\n#aa_output {\n    padding: 4px;\n    left: 34px;\n    top: 24px;\n    background: #000;\n    opacity: 0.5;\n    z-index: 10;\n    border-radius: 4px;\n    color: #fff;\n    text-shadow: 1px 1px 30px #000;\n    visibility: hidden;\n    font-family: monospace;\n    font-size: 14px;\n}\n\n#message_output {\n    padding: 4px;\n    left: 30px;\n    top: 345px;\n    width: 395px;\n    height: 60px;\n    background: #000;\n    opacity: 0.7;\n    z-index: 10;\n    border: 4px dotted #fff;\n    border-radius: 4px;\n    color: #fff;\n    text-shadow: 0px 0px 2px #ccc;\n}\n","html":"<script src='https://raw.github.com/Kanasansoft/ccv/for_realtime/js/ccv.js' type='text/javascript'></script>\n<script src='https://raw.github.com/Kanasansoft/ccv/for_realtime/js/ccv_for_realtime.js' type='text/javascript'></script>\n<script src='https://raw.github.com/Kanasansoft/ccv/for_realtime/js/face.js' type='text/javascript'></script>\n\n<canvas id=\"out\"></canvas>\n<div id=\"aa_output\"></div>\n<div id=\"message_output\"></div>\n<input type=\"text\" value=\"働きたくないでござる('A`)\" id=\"message_input\">\n<video id=\"video\"></video>","lisence":"MIT","js":"(function() {\n\n    var video = document.getElementById(\"video\");\n\n    var aa = \"'A`\";\n    var messageText = \"\";\n    var messageTextCnt = 0;\n    var inputedDate = undefined;\n    \n\n    // search bendor prefixed function/method and return found one\n    var withVendorPrefix = function(obj, member) {\n        return obj[member] || [\"webkit\", \"moz\", \"ms\"].inject(undefined, function(i, e) {\n            return i || obj[e + member.replace(/^\\w/, function(x){return x.toUpperCase();})];\n        });\n    };\n\n    //\n    // copy from http://d.hatena.ne.jp/chaichanPaPa/20080412/1207959725\n    var countByte = function(str) {\n        var count = 0;\n        for(var i = 0; i < str.length; i++) {\n            if (escape(str.charAt(i)).length < 4) {\n                count++;\n            }\n            else {\n                count += 2;\n            }\n        }\n        return count;\n    };\n\n    // add hook for message text\n    var message_input = $(\"message_input\");\n    $(\"message_input\").addEventListener(\"keypress\", function(e) {\n        // entered\n        if(e.keyCode === 13) {\n            e.preventDefault();\n            var elem = e.srcElement;\n            messageText = elem.value;\n            var r = messageText.match(/\\((.+)\\)/);\n            if(r) {\n                aa = r[1];\n            }\n            messageTextCnt = 0;\n            elem.value = \"\";\n            inputedDate = +new Date();\n            return false;\n        }\n    });\n\n    // setup for filter\n    var getUserMedia = withVendorPrefix(navigator, \"getUserMedia\");\n    if(!getUserMedia) {\n        alert(\"not supported\");\n        return;\n    }\n    getUserMedia.call(navigator, {video:true, toString: function(){return \"video\"}}, function(stream) {\n        var URL = withVendorPrefix(window, \"URL\");\n        var url = URL.createObjectURL(stream) || stream;\n        video.src = url;\n        video.play();\n        main();\n    }, function() {\n        alert(\"stream is not available\");\n        return;\n    });\n\n    // main routen\n    var main = function() {\n        $(\"message_input\").focus();\n        var d = new DCore($(\"out\"));\n        var dwork = d.subTexture(128, 128);\n        var detectedCache = [];\n    \n        \n        // face detection\n        (function() {\n            d.drawImage(video);\n            dwork.drawImage(d);\n    \n            var dt = new Date();\n            var grayscale = ccv.grayscale(dwork.canvas);\n            \n            var detected = ccv_for_realtime .detect_objects( {\n                \"canvas\" : grayscale,\n                \"cascade\" : cascade,\n                \"interval\" : 5,\n                \"min_neighbors\" : 1\n            });\n            \n            var now = +new Date();\n            var elapsed = now - inputedDate;\n            \n            // faces\n            if(detected.length === 0) {\n                detected = detectedCache;\n            }\n            detectedCache = detected;\n            detected.each(function(e) {\n                var center = [dwork.scr2World2d(e.x + e.width / 2), dwork.scr2World2d(e.y + e.height / 2)];\n                var radius = dwork.scr2World2d([e.width, e.height].abs());\n                var bytes = countByte(aa);\n                d\n                 .rgb(0xff, 0xff, 0xff)\n                 .circle(center, radius)\n                 .fill()\n                 .rgb(0xaa, 0xaa, 0xff)\n                 .circle(center, radius)\n                 .lineWidth(radius * 0.05 + 0.01)\n                 .stroke()\n                 .textAlign(\"center\")\n                 .textBaseline(\"middle\")\n                 .font(\"monospace\", radius / bytes * 2, \"bold\")\n                 .fillText(aa, center)\n                ;\n            });\n    \n            \n            window.setTimeout(arguments.callee, 33);\n        })();\n        \n        // control message output area\n        (function() {\n            \n            var now = +new Date();\n            var elapsed = now - inputedDate;\n            // message area\n            var outputLen = Math.min(messageText.length, ~~(elapsed * 0.01));\n            \n            $(\"message_output\").innerText = messageText.substr(0, outputLen);\n    \n            if(aa.length) {\n                var text = \"気分 \" + aa;\n                $(\"aa_output\").style.visibility = \"visible\";\n                $(\"aa_output\").innerText = text;        \n                $(\"aa_output\").style.width = (countByte(text) * 14 * 0.5 + 4) + \"px\";\n            } else {\n                $(\"aa_output\").style.visibility = \"hidden\";\n            }\n            window.setTimeout(arguments.callee, 33);\n        })();\n    };    \n\n})();\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/i/q/l/iqlP_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/i/q/l/iqlP.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/i/q/l/iqlP_100.jpg"},"description_html":"顔文字で動的に中の人をデコレートして、サウンドノベル風に動かすプロトタイプ。<br />\r\nリソースさえ許せば、ビデオチャットとかで実用的かも。<br />\r\n※Webカメラが必要です。<br />\r\n<br />\r\n<br />\r\n○操作<br />\r\n入力文字列から顔文字を検出するとWebカメラの人の顔の位置へ画像合成します。<br />\r\n括弧で囲んだ文字が顔文字と認識されます。<br />\r\nEx )   働きたくないでござる('A`)　→ 　'A`<br />\r\n<br />\r\n○環境<br />\r\nChrome以外は動きません。<br />\r\n確認は　Chrome バージョン 23.0.1271.97 m<br />\r\n","parent":{"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/u/9/m/u9mc_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/u/9/m/u9mc.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/u/9/m/u9mc_100.jpg"},"modified_date":"2012-12-05 16:56:39","uid":"u9mc","created_date":"2012-12-04 12:07:57","path":"u9mc","description":"<a href=\"http://jsdo.it/event/html5csc/vol3/\" target=\"_blank\">http://jsdo.it/event/html5csc/vol3/</a>\r\n\r\nこのコードは、第三回全国統一 HTML5実技コンテストのエントリー用コードです。  \r\nサイトからエントリーをし、こちらのコードをフォークしてください。\r\n\r\n-------------------------\r\n\r\n## お題：HTML5で表情豊かに表現する「顔文字(・∀・)」\r\n\r\nHTML5で、表情豊かな顔文字の表現にチャレンジしてください。  \r\n顔文字の素材は、エントリー用コードを使っても良いですし、お好きな顔文字でも構いません。  \r\nインタラクティブに操作ができたり、ツールとして便利なものにしたり、  \r\nゲーム性を持たせたりするなど、表現の方法に制限はありません。  \r\n主に、表現力や発想力、インタラクションを評価します。  \r\n自由な発想をお待ちしています！\r\n\r\n**※アスキーアートも扱って良いものとします**","statistic":{"forked":"106","favorite":"2","pageview":"29367"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/6/7/b/5/67b56e45ea501eedd27eec70435d26553c0eace6_100.jpg","name":"jsdo.it_team"},"url":"http://jsdo.it/jsdo.it_team/u9mc","title":"第三回全国統一 HTML5実技コンテスト エントリー用コード"},"modified_date":"2013-01-06 23:18:44","uid":"iqlP","created_date":"2013-01-06 22:58:51","path":"iqlP","description":"顔文字で動的に中の人をデコレートして、サウンドノベル風に動かすプロトタイプ。\r\nリソースさえ許せば、ビデオチャットとかで実用的かも。\r\n※Webカメラが必要です。\r\n\r\n\r\n○操作\r\n入力文字列から顔文字を検出するとWebカメラの人の顔の位置へ画像合成します。\r\n括弧で囲んだ文字が顔文字と認識されます。\r\nEx )   働きたくないでござる('A`)　→ 　'A`\r\n\r\n○環境\r\nChrome以外は動きません。\r\n確認は　Chrome バージョン 23.0.1271.97 m\r\n","statistic":{"forked":"0","favorite":"0","pageview":"9860"},"url":"http://jsdo.it/crispy/iqlP","user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"title":"Sound-novel like (prototype)"}