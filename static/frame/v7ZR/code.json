{"source":{"css":"* {\n  margin: 0px;\n  padding: 0px;\n}\nbody {\n  background: #fff;\n}\n\ncanvas {\n  position: absolute;\n  left: 0px;\n  top: 0px;\n  width: 100%;\n  height: 100%;\n  /*overflow: hidden;*/\n}\n","html":"<canvas id='world'></canvas>","lisence":"MIT","js":"window.onload = function() {\n\n\n\t// Create draw object\n\tvar d = new DCore();\n\n\tvar bgm = new Audio();\n\tbgm.src = \"http://dl.dropbox.com/u/3589634/resource/bgm/drumn_010.mp3\";\n\tbgm.loop = true;\n\tvar bindSe = new Audio();\n\tbindSe.src = \"http://dl.dropbox.com/u/3589634/resource/se/b_005.mp3\";\n\tvar damageSe = new Audio();\n\tdamageSe.src = \"http://dl.dropbox.com/u/3589634/resource/se/se05.ogg\"\n\tvar timeRemSe = new Audio();\n\ttimeRemSe.src = \"http://dl.dropbox.com/u/3589634/resource/se/b_052.mp3\";\n\tvar goalSe = new Audio();\n\tgoalSe.src = \"http://dl.dropbox.com/u/3589634/resource/se/b_046.mp3\";\n    \n    \tstart();\n\tfunction start() {\n\t\tbgm.play();\n\n\t\tvar keys = [];\n\t\twindow.addEventListener(\"keydown\", function(e) {\n\t\t\tkeys[e.keyCode] = true;\n\t\t\tif(37 <= e.keyCode && e.keyCode <= 40) {\n\t\t\t\te.preventDefault ? e.preventDefault() : e.returnValue = false;\n\t\t\t}\n\t\t}, false);\n\t\twindow.addEventListener(\"keyup\", function(e) {\n\t\t\tkeys[e.keyCode] = false;\n\t\t\tif(37 <= e.keyCode && e.keyCode <= 40) {\n\t\t\t\te.preventDefault ? e.preventDefault() : e.returnValue = false;\n\t\t\t}\n\t\t}, false);\n\n\t\t// Star (fall object)\n\t\tfunction Star() {\n\t\t\tStar.prototype.initialize.apply(this, $A(arguments));\n\t\t};\n\t\tStar.prototype = {\n\t\t\tinitialize: function() {\n\t\t\t\tthis.p = [0.5, 0.1];\n\t\t\t\tthis.s = [0, -0.01];\n\t\t\t\tthis.bound = false;\n\t\t\t\tthis.binder = undefined;\n\t\t\t\tthis.rotates = $R(-.1, .1).randf();\n\t\t\t\tthis.rotatep = $R(0, 100).randf();\n\t\t\t\tthis.h = $R(0, 1).randf();\n\t\t\t},\n\t\t\tact: function() {\n\t\t\t\t// on bound\n\t\t\t\tif(this.bound) {\n\t\t\t\t\tthis.binder.act();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.p = this.p.add(this.s);\n\t\t\t\t\tthis.s = this.s.mul(0.95);\n\t\t\t\t\tthis.s = this.s.add([0, 0.0007 + lv * 0.0001]);\n\t\t\t\t\tthis.rotates *= 1.001;\n\t\t\t\t}\n\t\t\t\tif(this.p[0] > 1) {\n\t\t\t\t\tif(this.bound) {\n\t\t\t\t\t\t//this.binder.rads *= -1.0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.s[0] *= -0.9\n\t\t\t\t\t\tthis.p[0] = 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(this.p[0] < 0) {\n\t\t\t\t\tif(this.bound) {\n\t\t\t\t\t\t//this.binder.rads *= -1.0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.s[0] *= -0.9\n\t\t\t\t\t\tthis.p[0] = 0;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// register particle\n\t\t\t\tif(this.s.abs() > 0.01) {\n\t\t\t\t\tvar particle = new Particle(this.p, [0, 0.02 + this.s.abs() / 10].rotate($R(0, 100).randf()), this.h);\n\t\t\t\t\tparticles.push(particle);\n\t\t\t\t}\n\n\t\t\t\tvar self = this;\n\t\t\t\tstructures.each(function(e) {\n\t\t\t\t\tif((self.p[1] - e.p1[1]).abs() < 0.05 && !e.honwaka) {\n\t\t\t\t\t\tif( e.p1[0] < self.p[0] && self.p[0] < e.p2[0]\n\t\t\t\t\t\t || e.p2[0] < self.p[0] && self.p[0] < e.p1[0]) {\n\t\t\t\t\t\t\te.honwaka = true;\n\t\t\t\t\t\t\tdamaged = true;\n\t\t\t\t\t\t\ttime -= 3;\n\t\t\t\t\t\t\tdamageSe.play();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.rotatep += this.rotates;\n\t\t\t},\n\t\t\tbind: function(sign) {\n\t\t\t\tif(!this.bound) {\n\t\t\t\t\tbindSe.play();\n\t\t\t\t\tthis.binder = new Binder(this, sign);\n\t\t\t\t\tthis.bound = true;\n\t\t\t\t}\n\t\t\t},\n\t\t\trelease: function() {\n\t\t\t\tthis.binder.release();\n\t\t\t\tthis.bound = false;\n\t\t\t\tthis.rotates *= 1.1;\n\t\t\t\tvar self = this;\n\t\t\t\t10.0.times(function() {\n\t\t\t\t\tvar particle = new Particle(self.p, [0, 0.02 + self.s.abs() / 2].rotate($R(0, 100).randf()), self.h);\n\t\t\t\t\tparticles.push(particle);\n\t\t\t\t});\n\t\t\t},\n\t\t\tdraw: function() {\n\t\t\t\t// form\n\t\t\t\tvar form = $R(0, 4).map(function(i) {\n\t\t\t\t\treturn [0.02, 0].rotate(i.toRadian() / 5 * 2);\n\t\t\t\t}).rotate(this.rotatep).translate(this.p);\n\n\t\t\t\t// draw\n\t\t\t\td\n\t\t\t\t .quads(form)\n\t\t\t\t .hsv(this.h, 0.3, 0.9)\n\t\t\t\t .fill()\n\t\t\t\t .hsv(this.h, 0.9, 0.45)\n\t\t\t\t .stroke()\n\t\t\t\t;\n\n\t\t\t\t// draw line from binder to this\n\t\t\t\tif(this.bound) {\n\t\t\t\t\td\n\t\t\t\t\t .rgb(0x99, 0x99, 0x99)\n\t\t\t\t\t .line([this.p, this.binder.p])\n\t\t\t\t\t .stroke()\n\t\t\t\t\t;\n\t\t\t\t\tthis.binder.draw();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\t// Binder (maru)\n\t\tfunction Binder(bindee, sign) {\n\t\t\tthis.bindee = bindee;\n\t\t\tvar bp = bindee.p;\n\t\t\tvar bs = bindee.s;\n\t\t\tvar nbs = bs.normalize(0.2);\n\t\t\tthis.sign = sign;\n\t\t\tthis.p = bp.add([-sign * nbs[1], sign * nbs[0]]);\n\t\t\tthis.pl = bp.distance(this.p);\n\t\t\tthis.sl = bs.abs();\n\t\t\tvar np = bp.sub(this.p);\n\t\t\tthis.radp = Math.atan2(np[1], np[0]);\n\t\t\tthis.rads = sign * (this.sl / this.pl);\n\t\t};\n\n\t\tBinder.prototype = {\n\t\t\tact: function() {\n\t\t\t\tvar t = this.bindee;\n\t\t\t\tthis.radp += this.rads;\n\t\t\t\tvar op = t.p.clone();\n\t\t\t\tt.p = this.p.add([this.pl, 0].rotate(this.radp));\n\t\t\t\tt.s = t.p.sub(op);\n\t\t\t\tif(Math.cos(this.radp) > 0) {\n\t\t\t\t\tthis.rads += 0.003;\n\t\t\t\t} else {\n\t\t\t\t\tthis.rads -= 0.003;\n\t\t\t\t}\n\n\t\t\t\tt.rotates = this.rads;\n\t\t\t},\n\t\t\trelease: function() {\n\t\t\t\tvar t = this.bindee;\n\t\t\t\tt.rotates *= $R(0.9, 4.0).randf();\n\t\t\t\tt.s = t.s.mul(1.1);\n\t\t\t},\n\t\t\tdraw: function() {\n\t\t\t\td\n\t\t\t\t .rgb(0x66, 0x66, 0x66)\n\t\t\t\t .circle(this.p, 0.01)\n\t\t\t\t .stroke()\n\t\t\t\t;\n\t\t\t}\n\t\t};\n\n\t\tfunction Structurer(p1, p2) {\n\t\t\tthis.p1 = p1;\n\t\t\tthis.p2 = p2;\n\t\t}\n\t\tStructurer.prototype = {\n\t\t\tdraw: function() {\n\t\t\t\td\n\t\t\t\t .quads([\n\t\t\t\t\t this.p1.translate([0, -0.01]), \n\t\t\t\t\t this.p2.translate([0, -0.01]),\n\t\t\t\t\t this.p2.translate([0,  0.01]),\n\t\t\t\t\t this.p1.translate([0,  0.01])\n\t\t\t\t ])\n\t\t\t\t .rgb(0xee, 0xee, 0xee)\n\t\t\t\t .fill()\n\t\t\t\t .rgb(0x99, 0x99, 0x99)\n\t\t\t\t .fill()\n\t\t\t\t;\n\t\t\t}\n\t\t};\n\n\t\tCamera = {\n\t\t\tfollow: function(y) {\n\t\t\t\tvar self = Camera;\n\t\t\t\tvar bottom = self.py + self.height;\n\t\t\t\tvar dy = y - bottom;\n\t\t\t\tif(dy > 0) {\n\t\t\t\t\tself.py += dy * 0.2;\n\t\t\t\t}\n\t\t\t},\n\t\t\tpy: 0.0,\n\t\t\theight: 0.3,\n\t\t}\n\n\t\tfunction Particle(p, s, h) {\n\t\t\tthis.p = p;\n\t\t\tthis.s = s;\n\t\t\tthis.rotatep = $R(0, 100).randf();\n\t\t\tthis.rotates = $R(-0.5, 0.5).randf();\n\t\t\tthis.h = h;\n\t\t}\n\t\tParticle.prototype = {\n\t\t\tact: function() {\n\t\t\t\tthis.p = this.p.add(this.s);\n\t\t\t\tthis.s = this.s.mul(0.90);\n\t\t\t\tthis.rotatep += this.rotates;\n\t\t\t},\n\t\t\tdraw: function() {\n\t\t\t\tvar form = $R(0, 2).map(function(i) {\n\t\t\t\t\treturn [0.01, 0].rotate(i.toRadian() / 3);\n\t\t\t\t}).rotate(this.rotatep).translate(this.p);\n\n\t\t\t\tvar s = this.s.abs() * 40;\n\n\t\t\t\td\n\t\t\t\t .quads(form)\n\t\t\t\t .blend(\"source-over\")\n\t\t\t\t .alpha(s)\n\t\t\t\t .hsv(this.h, 0.75, 0.7)\n\t\t\t\t .fill()\n\t\t\t\t .alpha(1.0)\n\t\t\t\t;\n\t\t\t}\n\t\t};\n\n\t\tNotifiler = function(p, msg, rgb) {\n\t\t\tthis.p = p;\n\t\t\tthis.msg = msg;\n\t\t\tthis.count = 0;\n\t\t\tthis.rgb = rgb\n\t\t}\n\t\tNotifiler.prototype = {\n\t\t\tact: function() {\n\t\t\t\t this.p[1] += $R(-0.01, 0.02).randf();\n\t\t\t\t this.p[0] += $R(-0.02, 0.02).randf();\n\t\t\t\t this.count++;\n\t\t\t},\n\t\t\tdraw: function() {\n\t\t\t\tif(this.count < 32) {\n\t\t\t\t\td\n\t\t\t\t\t .blend(\"source-over\")\n\t\t\t\t\t .alpha(1 - this.count / 32)\n\t\t\t\t\t .rgb(this.rgb)\n\t\t\t\t\t .font(\"monospace\", 0.1, \"bold\")\n\t\t\t\t\t .fillText(this.msg, this.p)\n\t\t\t\t\t;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\n\t\tvar stars = [new Star(0)];\n\t\tvar particles = [];\n\t\tvar sd = d.subTexture();\n\t\tvar structures = [];\n\t\tvar structuresMadeY = 1;\n\t\tvar structuresMadeC = 0;\n\t\tvar cnt = 0;\n\t\tvar damaged = false;\n\t\tvar lv = 1;\n\t\tvar time = 60.0;\n\t\tvar not = new Notifiler([0, 0], \"\");\n\t\t\n\t\tvar prevKeys = keys.clone();\n\t\tvar prevDate = +new Date();\n\t\tvar goalY = 15;\n\t\tvar score = 0;\n\n\t\t(function() {\n\n\n\t\t\tvar now = new Date();\n\t\t\tvar timeSpan = now - prevDate;\n\t\t\ttime -= timeSpan * 0.001;\n\n\t\t\tscore++;\n\n\t\t\t// left key pressed\n\t\t\tif(keys[37] && !prevKeys[37]) {\n\t\t\t\tstars[0].bind(1);\n\t\t\t}\n\t\t\tif(keys[39] && !prevKeys[39]) {\n\t\t\t\tstars[0].bind(-1);\n\t\t\t}\n\t\t\tif((!keys[37] && prevKeys[37]) ||\n\t\t\t   (!keys[39] && prevKeys[39])) {\n\t\t\t\tstars[0].release();\n\t\t\t}\n\t\t\tprevKeys = keys.clone();\n\n\t\t\t// make Structurer\n\t\t\t(function() {\n\t\t\t\tif(structuresMadeY < Camera.py) {\n\t\t\t\t\tvar s = 0.5 + $R(0, 0.2).randf();\n\t\t\t\t\tstructuresMadeY += s;\n\t\t\t\t\tstructuresMadeC++;\n\n\t\t\t\t\tvar y = Camera.py + 1.0;\n\t\t\t\t\tvar sign = [-1, 1][structuresMadeC % 2];\n\t\t\t\t\tvar p1 = [0.5 + sign * 0.5, y];\n\t\t\t\t\tvar p2 = [0.5 - sign * $R(0, 0.4 - 0.25 / lv).randf(), y];\n\n\t\t\t\t\tvar structure = new Structurer(p1, p2);\n\t\t\t\t\tstructures.push(structure)\n\t\t\t\t}\n\t\t\t})();\n\t\t\tstructures = structures.select(function(e) {\n\t\t\t\treturn e.p1[1] > Camera.py - 3;\n\t\t\t});\n\n\t\t\tstars.each(function(e) {\n\t\t\t\te.act();\n\t\t\t});\n\n\t\t\tparticles = particles.select(function(e) {\n\t\t\t\treturn e.s.abs() > 0.001;\n\t\t\t});\n\t\t\tparticles.each(function(e) {\n\t\t\t\te.act();\n\t\t\t});\n\n\n\t\t\tvar bottomBallY = stars.max(function(e) {\n\t\t\t\treturn e.p[1];\n\t\t\t});\n\t\t\tCamera.follow(bottomBallY);\n\n\t\t\t// initialize background\n\t\t\td\n\t\t\t .blend(\"source-over\")\n\t\t\t .rgb(damaged ? [0xff, 0xee, 0xee] : [0xff, 0xff, 0xff])\n\t\t\t .fillBack()\n\t\t\t .blend(\"source-over\")\n\t\t\t .alpha(1)\n\t\t\t;\n\n\t\t\td.save();\n\t\t\td.translate([0, -Camera.py]);\n\n\n\t\t\t// fill back bubble\n\n\t\t\tvar random = function() {\n\t\t\t  var x = 1;\n\t\t\t  return function() {\n\t\t\t\tx = (x * 22695477 + 1) & 0xffffff;\n\t\t\t\treturn (x >> 16) & 0x7fff;\n\t\t\t  };\n\t\t\t}();\n\t\t\t$R(0, 11).each(function(i) {\n\t\t\t\tvar offy = (~~(Camera.py * 10) / 10);\n\t\t\t\tvar y = offy + i / 10;\n\t\t\t\tvar x = (~~(y * (y + 4.5) * (y + 3.8)) % 10) / 10;\n\t\t\t\tvar w = (y * y * y) % 0.1;\n\t\t\t\tvar hue = (y * y * (y * 1.5)) % 1;\n\t\t\t\td\n\t\t\t\t .circle([x, y], w)\n\t\t\t\t .hsv(hue, 0.1, 0.98)\n\t\t\t\t .fill()\n\t\t\t\t;\n\t\t\t});\n\n\t\t\t// goal\n\t\t\t(function() {\n\t\t\t\td\n\t\t\t\t .rgb(0x99, 0xff, 0x99)\n\t\t\t\t .quads(Geo.rect().scale([1.0, 0.05]).translate([0, goalY]))\n\t\t\t\t .fill()\n\t\t\t\t;\n\t\t\t\tif(goalY < stars[0].p[1]) {\n\t\t\t\t\tnot = new Notifiler(stars[0].p, \"Time Reset!\", [0x00, 0x00, 0xff])\n\t\t\t\t\tgoalSe.play();\n\t\t\t\t\tscore += ~~time * 10 * lv;\n\t\t\t\t\ttime = 45;\n\t\t\t\t\tgoalY += 15 + lv;\n\t\t\t\t\tlv++;\n\t\t\t\t}\n\t\t\t})();\n\n\n\t\t\tparticles.each(function(e) {\n\t\t\t\te.draw();\n\t\t\t});\n\n\t\t\tstars.each(function(e) {\n\t\t\t\te.draw();\n\t\t\t});\n\n\t\t\tstructures.each(function(e) {\n\t\t\t\te.draw();\n\t\t\t});\n\n\t\t\tvar rr = 0;\n\t\t\tif(time < 10) {\n\t\t\t\tif(~~(prevDate / 1000) != ~~(now / 1000)) {\n\t\t\t\t\ttimeRemSe.play();\n\t\t\t\t\trr = 0.03;\n\t\t\t\t}\n\t\t\t}\n\n\n\t\t\t// time\n\t\t\td\n\t\t\t .rgb(0x00, 0x00, 0x00)\n\t\t\t .blend(\"source-over\")\n\t\t\t .alpha(0.5)\n\t\t\t .quads(Geo.rect().scale([1.0, 0.05]).translate([0, Camera.py]))\n\t\t\t .fill()\n\t\t\t .rgb(damaged ? [0xff, 0x00, 0x00] : [0xff, 0xff, 0xff])\n\t\t\t .font(\"monospace\", 0.05, \"bold\")\n\t\t\t .fillText(\"time \" + ~~(time) + \".\" + (~~(time * 10) % 10), [0.01, 0.01 + Camera.py].translate([rr, 0]))\n\t\t\t .fillText(\"score \" + score + \"(lv\" + lv + \")\", [0.61, 0.01 + Camera.py])\n\t\t\t;\n\n\t\t\tif(damaged) {\n\t\t\t\tnot = new Notifiler(stars[0].p, \"-Time3.0s\", [0xff, 0x00, 0x00])\n\t\t\t}\n\t\t\tnot.act();\n\t\t\tnot.draw();\n\n\t\t\t// restore\n\t\t\td.restore();\n\n\n\n\t\t\tprevDate = now;\n\t\t\tdamaged = false;\n\t\t\tcnt++;\n\n\t\t\tif(time < 0) {\n\t\t\t\tif(confirm(\"コインいっこいれる\")) {\n\t\t\t\t\tstart();\n\t\t\t\t} else {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twindow.setTimeout(arguments.callee, 16);\n\t\t\t}\n\t\t})();\n\t};\n};\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/v/7/Z/v7ZR_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/v/7/Z/v7ZR.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/v/7/Z/v7ZR_100.jpg"},"description_html":"矢印キーで左右に揺れながら早めに落っこちるゲーム","parent":{"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/f/F/2/fF2J_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/f/F/2/fF2J.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/f/F/2/fF2J_100.jpg"},"parent":{"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/b/I/L/bILV_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/b/I/L/bILV.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/b/I/L/bILV_100.jpg"},"modified_date":"2012-04-15 12:59:28","uid":"bILV","created_date":"2012-04-14 22:53:13","path":"bILV","description":"","statistic":{"forked":"1","favorite":"4","pageview":"2519"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/bILV","title":"trapezes--"},"modified_date":"2012-04-15 21:56:32","uid":"fF2J","created_date":"2012-04-15 21:50:00","path":"fF2J","description":"","statistic":{"forked":"1","favorite":"1","pageview":"2251"},"url":"http://jsdo.it/crispy/fF2J","user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"title":"trapezes--++ forked: trapezes--"},"modified_date":"2012-04-22 16:36:22","uid":"v7ZR","created_date":"2012-04-22 00:40:48","path":"v7ZR","description":"矢印キーで左右に揺れながら早めに落っこちるゲーム","statistic":{"forked":"0","favorite":"3","pageview":"1535"},"url":"http://jsdo.it/crispy/v7ZR","user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"title":"*trapezes--++-- forked: trapezes--++ forked: trapezes--"}