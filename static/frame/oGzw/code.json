{"source":{"css":"body { background-color: #000000; margin: 0px; overflow: hidden; }","html":"<canvas id='world'></canvas>","lisence":"MIT","js":"window.onload = (function() {\n\n  var d = new DCore();\n\n  // マウスイベント\n  var px, py, opx, opy, dx, dy, lbdown, dblclick, dblcount, lbclick = false;\n  window.addEventListener(\"mousemove\", function(e) {\n    px = e.clientX / d.width - d.left2d;\n    py = e.clientY / d.height - d.top2d;\n    if(opx) {\n      dx = opx - px;\n      dy = opy - py;\n    }\n    opx = px;\n    opy = py;\n  }, false);\n  window.addEventListener(\"mousedown\", function(e) {\n    lbclick = true;\n    lbdown = true;\n  }, false);\n  window.addEventListener(\"mouseup\", function(e) {\n    lbdown = false;\n  }, false);\n  window.addEventListener(\"dblclick\", function(e) {\n    dblclick = true;\n  }, false);\n\n  function Light(p, ss) {\n    this.p = p;\n    this.ss = ss;\n    this.hue = $R(0, 1).randf();\n    this.count = 0;\n  }\n  Light.prototype = {\n    act: function() {\n      this.count++;\n    },\n    draw: function() {\n      var hue = this.hue;\n      var s = this.ss * this.count;\n      d\n       .alpha(1 - (this.count / 10))\n       .blend(\"lighter\")\n       .luminous(this.p, s * 0.2, s, [\n         [0,   [hue, 0.0, 0.0].hsv()],\n         [1,   [hue, 0.7, 1.0].hsv()]\n       ])\n       .fill()\n      ;\n    }\n  };\n  Lights = {\n    initialize: function() {\n      Lights.es = [];\n    },\n    registor: function(e) {\n      Lights.es.push(e);\n    },\n    act: function() {\n      Lights.es = Lights.es.select(function(e) {\n        return e.count < 10;\n      });\n\n      Lights.es.each(function(e) {\n        e.act();\n      });\n    },\n    draw: function() {\n      Lights.es.each(function(e) {\n        e.draw();\n      });\n    }\n  };\n\n  // particle\n  function Particle(p, sp, s, hue) {\n    this.p = p;\n    this.sp = sp;\n    this.s = s;\n    this.hue = hue || $R(0, 1).randf();\n    this.active = true;\n    this.sid = this.genSid();\n  }\n  // and this methods\n  Particle.prototype = {\n    genSid: function() {\n      return Particle.sid = ++Particle.sid || 0;\n    },\n    act: function() {\n      var self = this;\n      self.sp = self.sp.mul(0.99);\n      //if(self.sp.square() < 0.000001) this.unactivate();\n\n      // movement\n      this.p = this.p.add(this.sp);\n\n      // wall hit test, reflection\n      $R(0, 1, false).each(function(e) {\n        if(self.p[e] < 0 || 1 < self.p[e]) {\n          self.p[e] = ~~self.p[e];\n          self.sp[e] *= -1;\n        }\n      });\n      \n      this.count = ++this.count || 0;\n    },\n    draw: function() {\n\n      var self = this;\n      var hue = this.hue;\n      var size = this.s;\n      \n      if(this.count < 4) {\n        size = size * (1 + Math.sin($R(0, 3).randf()) * (3 - this.count) / 6);\n      }\n      \n      d\n       .alpha(1)\n       .blend(\"lighter\")\n       .luminous(this.p, size * 0.2, size, [\n         [0,   [hue, 0.2, 0.8].hsv()],\n         [0.4, [hue, 0.1, 1.0].hsv()],\n         [0.5, [hue, 0.7, 0.3].hsv()],\n         [0.7, [hue, 0.8, $R(0.15, 0.2).randf()].hsv()],\n         [1,   [hue, 0.0, 0.0].hsv()]\n       ])\n       .fill()\n      ;\n    },\n    // kill me\n    unactivate: function() {\n      this.active = false;\n    }\n  };\n\n  Particles = {\n    initialize: function() {\n      Particles.es = [];\n    },\n    registor: function(e) {\n      Particles.es.push(e);\n    },\n    act: function() {\n      Particles.es.each(function(e1) {\n        Particles.es.each(function(e2) {\n          if(!e1.active) return;\n          if(!e2.active) return;\n          if(e1.sid === e2.sid) return;\n          var distance = e1.p.distance(e2.p);\n          var power = 1 / (distance * distance);\n          if(distance < 0.3) {\n            e1.sp = e1.sp.add(e2.p.sub(e1.p).mul(0.000001 * power));\n          }\n          if(distance < 0.01 * e1.s && (e1.hue - e2.hue).abs() > 0.2) {\n            e1.unactivate();\n            e2.unactivate();\n\n            if(e1.s > 0.1) {\n              $R(0, 3).each(function(e) {\n                var sp = [0, 0.03].rotate($R(0, 100).randf());\n                var p = new Particle(e1.p, sp, 0.05);\n                Particles.registor(p);\n              });\n              Lights.registor(new Light(e1.p, 0.15));\n            } else {\n              var p = new Particle(e1.p, e1.sp.add(e1.sp), e1.s + e2.s / Math.sqrt(5));\n              Particles.registor(p);\n              Lights.registor(new Light(e1.p, p.s / 2));\n            }\n          }\n        });\n      });\n\n      Particles.es = Particles.es.select(function(e) {\n        return e.active;\n      });\n\n      Particles.es.each(function(e) {\n        e.act();\n      });\n    },\n    draw: function() {\n      Particles.es.each(function(e) {\n        e.draw();\n      });\n    }\n  };\n\n\n  var c = 0;\n  Particles.initialize();\n  Lights.initialize();\n  \n  $R(0, 16, true).each(function() {\n    var sp = [0, 0.0001].rotate($R(0, 100).randf());\n    var p = new Particle([$R(0, 1).randf(), $R(0, 1).randf()], sp.mul(0.8), 0.05);\n    Particles.registor(p);\n  });\n\n\n  window.setInterval(function() {\n    c++;\n\n    if(px) {\n      if(lbclick) {\n        $R(0, 1, true).each(function() {\n          var sp = [0, 0.0001].rotate($R(0, 100).randf()).add([dx, dy].mul(-0.1));\n          var p = new Particle([px, py], sp.mul(0.8), 0.05);\n          Particles.registor(p);\n        });\n      }\n    }\n\n    // fill back\n    d\n     .blend(\"copy\")\n     .alpha(1)\n     .rgb(0x00, 0x00, 0x00)\n     .fillBack()\n     .fill()\n    ;\n\n    Particles.act();\n    Particles.draw();\n\n    Lights.act();\n    Lights.draw();\n\n    lbclick = false;\n\n  }, 33);\n});\n\n// vim:sw=2:ts=2\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/o/G/z/oGzw_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/o/G/z/oGzw.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/o/G/z/oGzw_100.jpg"},"description_html":"クリックして光ってくっついて爆発<br />\n<br />\n(追記) 詰めが甘いところ修正","modified_date":"2011-01-27 23:27:46","uid":"oGzw","created_date":"2011-01-24 01:17:48","path":"oGzw","description":"クリックして光ってくっついて爆発\n\n(追記) 詰めが甘いところ修正","statistic":{"forked":"2","favorite":"7","pageview":"2704"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/oGzw","title":"light reaction"}