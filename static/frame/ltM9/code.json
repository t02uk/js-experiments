{"source":{"css":"body { background-color: #000; margin: 0px; overflow: hidden; }\r\n","html":"<canvas id='world'></canvas>","lisence":"MIT","js":"(function() {\r\n\r\n\tvar d = new DCore();\r\n\r\n\tvar fallingTime = 5;\r\n\t// \r\n\tvar __DEBUG__ = false;\r\n\r\n\tvar seTick = new Audio(\"http://dl.dropbox.com/u/3589634/resource/se/s-002.mp3\");\r\n\tvar seBlight = new Audio(\"http://dl.dropbox.com/u/3589634/resource/se/computer-pipipi_mono.mp3\");\r\n\tseBlight.volume = 0.7;\r\n\tvar seInvert = new Audio(\"http://dl.dropbox.com/u/3589634/resource/se/electric2_mono.mp3\");\r\n\r\n\tvar invert = false;\r\n\r\n\t// debug\r\n\tvar getDate = (function() {\r\n\t\tif(__DEBUG__) {\r\n\t\t\tvar startDt = new Date();\r\n\t\t\treturn function() {\r\n\t\t\t\tvar now = new Date();\r\n\t\t\t\tvar elapsed = now - startDt;\r\n\t\t\t\tvar ret = now;\r\n\t\t\t\tret.setHours(22);\r\n\t\t\t\tret.setMinutes(20);\r\n\t\t\t\tret.setSeconds(1);\r\n\t\t\t\tret.setMilliseconds(345);\r\n\t\t\t\treturn new Date((+ret) + elapsed * 1);\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\treturn function() {\r\n\t\t\t\treturn new Date();\r\n\t\t\t}\r\n\t\t}\r\n\t})();\r\n\r\n\t// setup form of shape\r\n\t// note that the letter \";\" means backslash :<\r\n\tvar numberShapes = (function() {\r\n\t\tvar raw = [\r\n\t\t\t// 0\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"  -   \" ,\r\n\t\t\t// 1\r\n\t\t\t\"- |   \" +\r\n\t\t\t\"  |   \" +\r\n\t\t\t\"  |   \" +\r\n\t\t\t\"  |   \" +\r\n\t\t\t\"- - - \" ,\r\n\t\t\t// 2\r\n\t\t\t\"- -   \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"|     \" +\r\n\t\t\t\"  - - \" ,\r\n\t\t\t// 3\r\n\t\t\t\"- -   \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"- -   \" ,\r\n\t\t\t// 4\r\n\t\t\t\"    | \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"| - | \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"    | \" ,\r\n\t\t\t// 5\r\n\t\t\t\"  - - \" +\r\n\t\t\t\"|     \" +\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"- -   \" ,\r\n\t\t\t// 6\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"|     \" +\r\n\t\t\t\"| -   \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"  -   \" ,\r\n\t\t\t// 7\r\n\t\t\t\"- -   \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"  /   \" ,\r\n\t\t\t// 8\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"  -   \" ,\r\n\t\t\t// 9\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"|   | \" +\r\n\t\t\t\"  -   \" +\r\n\t\t\t\"    | \" +\r\n\t\t\t\"  -   \" ,\r\n\t\t\t// :b\r\n\t\t];\r\n\r\n\t\t// then compile above raw document\r\n\t\tvar compiled = raw.map(function(shape) {\r\n\r\n\t\t\t// a table for convert a character to rotation\r\n\t\t\tvar c2a = {\r\n\t\t\t\t'-': 0.000.toRadian(),\r\n\t\t\t\t';': 0.125.toRadian(),\r\n\t\t\t\t'|': 0.250.toRadian(),\r\n\t\t\t\t'/': 0.375.toRadian(),\r\n\t\t\t\t' ': undefined, // will be ignored\r\n\t\t\t};\r\n\t\t\tvar r = shape.split(\"\").zipWithIndex().filter(function(x) {\r\n\t\t\t\t// skip\r\n\t\t\t\treturn x[1] % 2 == 0;\r\n\t\t\t}).map(function(e) {\r\n\t\t\t\t//\r\n\t\t\t\tvar c = e[0];\r\n\t\t\t\tvar i = e[1] / 2;\r\n\t\t\t\tvar a = c2a[c];\r\n\t\t\t\tvar x = i % 3;\r\n\t\t\t\tvar y = ~~(i / 3);\r\n\t\t\t\treturn {x: x, y: y, rotation: a};\r\n\t\t\t}).filter(function(x) {\r\n\t\t\t\t//\r\n\t\t\t\treturn x.rotation !== undefined;\r\n\t\t\t});\r\n\r\n\t\t\treturn r;\r\n\t\t});\r\n\r\n\t\treturn compiled;\r\n\t})();\r\n\r\n\t// letter class\r\n\tfunction LetterTexture(text) {\r\n\t\tthis.text = text;\r\n\t\tvar width = 32;\r\n\t\tvar height = 32;\r\n\r\n\t\tvar texture = d.subTexture(width, height);\r\n\r\n\t\tthis.texture1 = texture;\r\n\t\ttexture\r\n\t\t .rgb(0x00, 0x00, 0x00)\r\n\t\t .font(\"Cursive\", 1.0)\r\n\t\t .textAlign(\"center\")\r\n\t\t .textBaseline(\"middle\")\r\n\t\t .fillText(text, [0.5, 0.5])\r\n\t\t .fill()\r\n\t\t;\r\n\r\n\t\tvar texture = d.subTexture(width, height);\r\n\t\tthis.texture2 = texture;\r\n\t\ttexture\r\n\t\t .rgb(0xff, 0xff, 0xff)\r\n\t\t .font(\"Cursive\", 1.0)\r\n\t\t .textAlign(\"center\")\r\n\t\t .textBaseline(\"middle\")\r\n\t\t .fillText(text, [0.5, 0.5])\r\n\t\t .fill()\r\n\t\t;\r\n\t}\r\n\tLetterTexture.prototype = {\r\n\t\tdraw: function() {\r\n\t\t\tif(!invert) {\r\n\t\t\t\td\r\n\t\t\t\t .drawImage(this.texture1)\r\n\t\t\t\t;\r\n\t\t\t} else {\r\n\t\t\t\td\r\n\t\t\t\t .drawImage(this.texture2)\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t},\r\n\t};\r\n\r\n\r\n\t// Letter\r\n\tfunction Letter(text, timing) {\r\n\t\tvar proto = Letter.prototype;\r\n\t\tthis.texture = proto.letter(text);\r\n\t\tthis.timing = text;\r\n\t\tthis.fRad = 100.0.randf();\r\n\t\tthis.blightCnt = 0;\r\n\t}\r\n\tLetter.prototype = {\r\n\t\tstartState: function(p, rotation) {\r\n\t\t\tthis.p = p;\r\n\t\t\tthis.rotation = rotation;\r\n\t\t},\r\n\t\tendState: function(p, rotation, rotateAxis) {\r\n\t\t\tif(this.pEnd) {\r\n\t\t\t\tthis.p = this.pEnd;\r\n\t\t\t\tthis.rotation = this.rotationEnd;\r\n\t\t\t}\r\n\t\t\tthis.pEnd = p;\r\n\t\t\tthis.rotationEnd = rotation;\r\n\t\t\tthis.rotateAxis = [1.0.randf(), 1.0.randf(), 1.0.randf()].normalize();\r\n\t\t},\r\n\t\tact: function() {\r\n\t\t},\r\n\t\tblightAfter: function(a) {\r\n\t\t\tthis.blightAfterCnt = a;\r\n\t\t\tthis.blightCnt = 64;\r\n\t\t},\r\n\t\tdraw: function(seconds, millis) {\r\n\r\n\t\t\tvar sm = (seconds * 1000) + millis;\r\n\r\n\t\t\t// 0(s)  ->  seconds  -> $1  ->  $2  ->  seconds + 10(s)  ->  $3  ->  60(s)\r\n\t\t\t//  $n means this.timing\r\n\t\t\t// condition\r\n\t\t\t//  $1 -> use start state\r\n\t\t\t//  $2 -> falling (calculate)\r\n\t\t\t//  $3 -> use end state\r\n\t\t\t//\r\n\t\t\tif(seconds < fallingTime && (60 - this.timing) < fallingTime) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif(0 <= seconds && seconds < this.timing) {\r\n\t\t\t\tvar p = this.p;\r\n\t\t\t} else if(this.timing <= seconds && seconds < this.timing + fallingTime) {\r\n\t\t\t\tvar delta = (sm - this.timing * 1000) / (fallingTime * 1000);\r\n\t\t\t\tvar deltaR = 1 - delta;\r\n\t\t\t\tvar p = this.p.mul(deltaR).add(this.pEnd.mul(delta));\r\n\t\t\t\tvar rotateA = (((this.timing % 11) - 5) * delta).toRadian();\r\n\t\t\t\tif(!rotateA) {\r\n\t\t\t\t\tvar rotateA = (((this.timing % 10) - 5) * delta).toRadian();\r\n\t\t\t\t}\r\n\t\t\t\t// wind (?)\r\n\t\t\t\tp = p.add([Math.sin(delta.toRadian()) * 0.1, 0, 0].rotatey(sm * 0.000001));\r\n\t\t\t} else {\r\n\t\t\t\tvar p = this.pEnd;\r\n\t\t\t}\r\n\r\n\r\n\t\t\tvar proto = Letter.prototype;\r\n\t\t\tif(!proto.fromTempl) {\r\n\t\t\t\tproto.fromTempl = Geo.rect();\r\n\t\t\t}\r\n\t\t\tvar from = proto.fromTempl;\r\n\r\n\t\t\tif(!proto.toTempl) {\r\n\t\t\t\tvar rect = Geo.rect(true).map(function(e) {\r\n\t\t\t\t\treturn [e[0], 0, e[1]];\r\n\t\t\t\t});\r\n\t\t\t\tproto.toTempl = rect.scale([-0.03, 1, 0.03]);\r\n\t\t\t}\r\n\t\t\tvar to = proto.toTempl;\r\n\t\t\tto = to.invoke(\"rotatey\", this.rotation);\r\n\t\t\tif(rotateA) {\r\n\t\t\t\tto = to.invoke(\"rotatea\", rotateA, this.rotateAxis);\r\n\t\t\t}\r\n\t\t\tto = to.translate(p);\r\n\r\n\t\t\tvar self = this;\r\n\t\t\td\r\n\t\t\t .transformTo(from, to, function(d) {\r\n\t\t\t\tif(self.blightAfterCnt < 0) {\r\n\t\t\t\t\tif(self.blightCnt > 0) {\r\n\t\t\t\t\t\td\r\n\t\t\t\t\t\t .alpha(0.5)\r\n\t\t\t\t\t\t .rgb(0x99, 0x99, 0x99)\r\n\t\t\t\t\t\t .quads(Geo.rect())\r\n\t\t\t\t\t\t .fill()\r\n\t\t\t\t\t\t .alpha(1)\r\n\t\t\t\t\t\t;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tself.texture.draw();\r\n\t\t\t })\r\n\t\t\tself.blightAfterCnt--;\r\n\t\t\tself.blightCnt--;\r\n\r\n\t\t\t// draw emit effect\r\n\t\t\tif(this.timing === seconds) {\r\n\t\t\t\tif(millis < 500) {\r\n\t\t\t\t\tvar ps = millis * 0.001;\r\n\t\t\t\t\tvar m = 32;\r\n\t\t\t\t\tvar ps = $R(0, m).map(function(x) {\r\n\t\t\t\t\t\tvar r = (1 - Math.sin(ps.toRadian() / 6)) * (0.01 + Math.cos(ps * $R(0.5, 1).randf() * 3) * 0.03);\r\n\t\t\t\t\t\tvar sp = [0, 0, r].rotatey(x.toRadian() / m * 1);\r\n\t\t\t\t\t\treturn sp.add(self.p);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconsole.info(ps.inspect());\r\n\t\t\t\t\tconsole.info = function(){};\r\n\r\n\t\t\t\t\td\r\n\t\t\t\t\t .alpha(0.5)\r\n\t\t\t\t\t .rgb(invert ? [0xff, 0xff, 0xff] : [0x00, 0x00, 0x00])\r\n\t\t\t\t\t .line(ps)\r\n\t\t\t\t\t .stroke()\r\n\t\t\t\t\t .alpha(1.0)\r\n\t\t\t\t\t;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tletter: function(x) {\r\n\t\t\tvar proto = Letter.prototype;\r\n\t\t\tif(proto.lettersCache === undefined) {\r\n\t\t\t\tproto.lettersCache = [];\r\n\t\t\t}\r\n\t\t\tif(proto.lettersCache[x] === undefined) {\r\n\t\t\t\tproto.lettersCache[x] = new LetterTexture(x);\r\n\t\t\t}\r\n\t\t\treturn proto.lettersCache[x];\r\n\t\t},\r\n\t};\r\n\r\n\r\n\t// funtion for camera animation (bezier)\r\n\tvar bezier = function(p1, p2, p3, p4) {\r\n\t\treturn function(t) {\r\n\t\t\tvar u = 1 - t;\r\n\t\t\treturn p1.mul(u * u * u)\r\n\t\t\t\t.add(p2.mul(u * u * t * 3))\r\n\t\t\t\t.add(p3.mul(u * t * t * 3))\r\n\t\t\t\t.add(p4.mul(t * t * t));\r\n\t\t};\r\n\t};\r\n\r\n\t// funtion for camera animation (linear)\r\n\tvar linear = function(p1, p4) {\r\n\t\treturn bezier(p1, p1, p4, p4);\r\n\t};\r\n\r\n\tfunction Camera(geta) {\r\n\t\tthis.c = 0;\r\n\t\tthis.p = 0;\r\n\t\tthis.g = 0;\r\n\t\tthis.geta = geta;\r\n\t\tthis.by = 0;\r\n\t}\r\n\r\n\tCamera.prototype = {\r\n\t\tobtainInfo: function(elapsed, now, layer) {\r\n\t\t\tthis.lastNow = this.now;\r\n\t\t\tthis.elapsed = elapsed;\r\n\t\t\tthis.now = now;\r\n\t\t\tthis.layer = layer;\r\n\t\t\tthis.vizLayer = layer;\r\n\t\t\tif(!this.layerP || !(this.layerP && this.now.getSeconds() >= 50 || this.now.getSeconds() < 10)) {\r\n\t\t\t\tthis.layerP = [0, layer, 0];\r\n\t\t\t}\r\n\t\t},\r\n\t\t// update animation function\r\n\t\tupdateAnimator: function(pa, ga, ua) {\r\n\t\t\tthis.pAnimator = pa;\r\n\t\t\tthis.gAnimator = ga;\r\n\t\t\tthis.uAnimator = ua;\r\n\t\t},\r\n\t\t// apply animation and move camera\r\n\t\tmove: function(t) {\r\n\t\t\tif(this.pAnimator) this.p = this.pAnimator(t).add(this.layerP);\r\n\t\t\tif(this.gAnimator) this.g = this.gAnimator(t).add(this.layerP);\r\n\t\t\tif(this.uAnimator) this.u = this.uAnimator(t).add(this.layerP);\r\n\t\t},\r\n\t\tact: function() {\r\n\t\t\tvar t = this.elapsed + this.geta;\r\n\t\t\tvar m = (+this.now) % 10000;\r\n\t\t\tif(this.now.getSeconds() >= 50 || this.now.getSeconds() < 10) {\r\n\t\t\t\tthis.updateAnimator(\r\n\t\t\t\t\tbezier([-3.0, +0.3, +0.5], [-0.3, +0.9, +0.5], [-0.0, +0.9, +0.9], [-0.0, -0.5, -0.5]),\r\n\t\t\t\t\tlinear([+0.0, +0.0, +0.0], [+0.0, +0.0, +0.0])\r\n\t\t\t\t);\r\n\t\t\t\tthis.move((((this.now.getSeconds() + 10) % 60) * 1000 + this.now.getMilliseconds()) / (20 * 1000));\r\n\t\t\t} else {\r\n\t\t\t\tif(this.lastNow == undefined\r\n\t\t\t\t|| (this.now.getSeconds() != this.lastNow.getSeconds() && this.now.getSeconds() % 10 == 0)) {\r\n\t\t\t\t\tvar mode = 6..rand();\r\n\t\t\t\t\tswitch(mode) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tvar r = function() {\r\n\t\t\t\t\t\t\t\treturn [$R(-0.7, 0.7).randf(), $R(-0.0, 0.9).randf() ,$R(-0.7, +0.7).randf()];\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tthis.updateAnimator(\r\n\t\t\t\t\t\t\t\tlinear(r(), r()),\r\n\t\t\t\t\t\t\t\tlinear(r(), [+0.0, -10.0, +0.0])\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\t\tthis.updateAnimator(\r\n\t\t\t\t\t\t\t\tbezier([-0.5, +1.0, +0.2], [-0.0, +0.1, -0.5], [-0.5, +0.3, +0.8], [-0.5, +0.9, +0.2]),\r\n\t\t\t\t\t\t\t\tlinear([+0.0, +0.0, +0.0], [+0.3, -0.0, +0.0])\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 3:\r\n\t\t\t\t\t\t\tthis.updateAnimator(\r\n\t\t\t\t\t\t\t\tbezier([+0.5, +0.0, +0.2], [-0.0, +0.1, +0.2], [-0.5, +0.3, +0.8], [-1.0, +0.9, -0.8]),\r\n\t\t\t\t\t\t\t\tlinear([+0.0, +0.0, +0.0], [+0.0, -0.0, +0.0])\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\t\tthis.updateAnimator(\r\n\t\t\t\t\t\t\t\tbezier([+0.5, +0.5, +0.0], [+0.0, +0.5, +0.5], [-0.5, +0.5, +0.0], [+0.0, +0.5, -0.5]),\r\n\t\t\t\t\t\t\t\tlinear([+0.0, +0.0, +0.0], [+0.0, +1.0, +0.0])\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 5:\r\n\t\t\t\t\t\t\tthis.updateAnimator(\r\n\t\t\t\t\t\t\t\tlinear([+0.5, +0.5, +0.0], [+0.0, +0.8, +0.5]),\r\n\t\t\t\t\t\t\t\tlinear([+0.0, +1.0, +0.0], [+0.0, -0.0, +0.0])\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.move(m / (10 * 1000));\r\n\t\t\t}\r\n\r\n\t\t\td\r\n\t\t\t .gazeFrom(this.p, this.g, this.u)\r\n\t\t\t;\r\n\r\n\t\t\t// !!change global variable\r\n\t\t\tif((~~this.p[1] - 100) % 2) {\r\n\t\t\t\tinvert = true;\r\n\t\t\t} else {\r\n\t\t\t\tinvert = false;\r\n\t\t\t}\r\n\t\t\tthis.vizLayer = ~~this.p[1];\r\n\t\t}\r\n\t};\r\n\r\n\t(function() {\r\n\t\tvar startDate = getDate();\r\n\t\t// initialize state full variables and function\r\n\r\n\t\t// letters object\r\n\t\tvar letters = $R(0, 59).map(function(x) {\r\n\t\t\treturn new Letter(x, x);\r\n\t\t});\r\n\r\n\t\t// camera\r\n\t\tvar geta = 0\r\n\t\tgeta = startDate.getSeconds();\r\n\t\tgeta = (geta * 1000) + startDate.getMilliseconds();\r\n\t\tvar camera = new Camera(geta);\r\n\r\n\t\tvar mapping = function(times, by, setupMethod) {\r\n\r\n\t\t\t// shuffle and allocate to randomly\r\n\t\t\tvar tail = [];\r\n\t\t\tfor(var i = 0; i < fallingTime; i++) {\r\n\t\t\t\ttail.push(letters[letters.length - i - 1]);\r\n\t\t\t\ttail.push(letters[i]);\r\n\t\t\t}\r\n\t\t\tvar len = tail.length;\r\n\t\t\tvar shuffledLetters = letters.slice(fallingTime, - fallingTime).shuffle();\r\n\t\t\tfor(var i = 0; i < len ; i++) {\r\n\t\t\t\tvar x = tail.pop();\r\n\t\t\t\tshuffledLetters.push(x);\r\n\t\t\t}\r\n\r\n\t\t\tvar mapped = times.zipWithIndex(function(t, digit) {\r\n\t\t\t\tvar shape = numberShapes[t];\r\n\t\t\t\treturn shape.map(function(s) {\r\n\r\n\t\t\t\t\tvar x = -(s.x * 0.03 + 0.03 + digit * 0.25 - 0.5);\r\n\t\t\t\t\tvar y = by;\r\n\t\t\t\t\tvar z = s.y * 0.04 - 0.03;\r\n\t\t\t\t\tvar p = [x, y, z];\r\n\r\n\t\t\t\t\tvar a = s.rotation + 0.25.toRadian() + (2..rand() * 0.5.toRadian() + $R(-0.3, 0.3).randf());\r\n\t\t\t\t\tvar letter = shuffledLetters.shift();\r\n\t\t\t\t\tletter.regular = true;\r\n\r\n\t\t\t\t\tsetupMethod.call(letter, p, a);\r\n\r\n\t\t\t\t\treturn letter;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tvar remain = shuffledLetters;\r\n\r\n\t\t\tremain.each(function(e) {\r\n\t\t\t\tvar x = $R(-0.5, 0.5).randf();\r\n\t\t\t\tvar y = by;\r\n\t\t\t\tvar z = $R(-0.5, 0.5).randf();\r\n\t\t\t\tvar p = [x, y, z];\r\n\t\t\t\tvar a = $R(-1, 1).randf();\r\n\t\t\t\te.regular = false;\r\n\t\t\t\tsetupMethod.call(e, p, a);\r\n\t\t\t});\r\n\r\n\t\t\tvar r = mapped.flatten().concat(remain);\r\n\t\t\treturn r;\r\n\t\t};\r\n\r\n\t\t// devide Date object into [hh, mm]\r\n\t\tvar hhmm = function(date) {\r\n\t\t\tvar minutes = date.getMinutes();\r\n\t\t\tvar hours = date.getHours();\r\n\r\n\t\t\tvar hours2 = ~~(hours / 10);\r\n\t\t\tvar hours1 = hours % 10;\r\n\t\t\tvar minutes2 = ~~(minutes / 10);\r\n\t\t\tvar minutes1 = minutes % 10;\r\n\r\n\t\t\treturn [hours2, hours1, minutes2, minutes1];\r\n\t\t};\r\n\t\tvar past = new Date(getDate() -  60 * 1000);\r\n\t\tvar now = getDate();\r\n\t\tvar mappedLetters = mapping(hhmm(now), 0, Letter.prototype.startState);\r\n\r\n\r\n\t\t// here is main loop :b\r\n\t\tvar layer = 0;\r\n\t\tvar oldInvert = invert;\r\n\t\tvar invertCount = 0;\r\n\t\tvar beatCnt = 0;\r\n\t\tvar main = function() {\r\n\r\n\t\t\tvar now = getDate();\r\n\t\t\tvar next = new Date(+getDate() + 60 * 1000);\r\n\t\t\tvar elapsed = now - startDate;\r\n\r\n\t\t\t// seconds is changed\r\n\t\t\tif(now.getSeconds() !== past.getSeconds()) {\r\n\t\t\t\tif(seTick.currentTime) {\r\n\t\t\t\t\tseTick.pause();\r\n\t\t\t\t\tseTick.currentTime = 0;\r\n\t\t\t\t}\r\n\t\t\t\tbeatCnt += 4;\r\n\t\t\t\tseTick.play();\r\n\t\t\t}\r\n\r\n\t\t\t// minutes is changed\r\n\t\t\tif(now.getMinutes() !== past.getMinutes()) {\r\n\t\t\t\tlayer--;\r\n\t\t\t\tif(now.getSeconds() == 0) {\r\n\r\n\t\t\t\t\tif(seBlight.currentTime) {\r\n\t\t\t\t\t\tseBlight.pause();\r\n\t\t\t\t\t\tseBlight.currentTime = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tseBlight.play();\r\n\r\n\t\t\t\t\tvar ms = now.getMilliseconds();\r\n\t\t\t\t\tvar p = ~~(mappedLetters.length * (1 - ms / 1000));\r\n\r\n\t\t\t\t\tmappedLetters.select(function(x) {\r\n\t\t\t\t\t\treturn x.regular;\r\n\t\t\t\t\t}).zipWithIndex(function(x, i) {\r\n\t\t\t\t\t\tx.blightAfter(~~(i * mappedLetters.length * 0.016));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tmappedLetters = mapping(hhmm(next), layer, Letter.prototype.endState);\r\n\t\t\t}\r\n\r\n\t\t\tpast = now;\r\n\r\n\t\t\t// initialize background\r\n\t\t\td\r\n\t\t\t .rgb(invert ? [0x00, 0x00, 0x00] : [0xff, 0xff, 0xff])\r\n\t\t\t .fillBack()\r\n\t\t\t;\r\n\r\n\t\t\t// beat\r\n\t\t\tvar s = Math.sin(beatCnt.toRadian() / 32) * 0.07 + 0.1;\r\n\t\t\tvar q = Geo.polygon(32).map(function(x) {\r\n\t\t\t\treturn [x[0] * s, 0, x[1] * s];\r\n\t\t\t});\r\n\r\n\t\t\t9..times(function(i) {\r\n\t\t\t\tvar x = ((i % 3) - 1) * 0.5;\r\n\t\t\t\tvar z = ((~~(i / 3)) - 1) * 0.5;\r\n\t\t\t\td\r\n\t\t\t\t .rgb(invert ? [0x11, 0x11, 0x11] : [0xee, 0xee, 0xee])\r\n\t\t\t\t .quads(q.translate([x, camera.vizLayer - 1, z]))\r\n\t\t\t\t .fill()\r\n\t\t\t\t;\r\n\t\t\t});\r\n\r\n\t\t\tif(beatCnt > 0) {\r\n\t\t\t\tbeatCnt--;\r\n\t\t\t}\r\n\r\n\t\t\td\r\n\t\t\t .rgb(invert ? [0xff, 0xff, 0xff] : [0x00, 0x00, 0x00])\r\n\t\t\t .fillText(now, [0.0, 0.0])\r\n\t\t\t;\r\n\r\n\t\t\t// camera\r\n\t\t\tcamera.obtainInfo(elapsed, now, layer);\r\n\t\t\tcamera.act();\r\n\r\n\t\t\t// draw letters\r\n\t\t\tvar seconds = now.getSeconds();\r\n\t\t\tvar millis = now.getMilliseconds();\r\n\r\n\t\t\tmappedLetters.each(function(x) {\r\n\t\t\t\tx.draw(seconds, millis);\r\n\t\t\t});\r\n\r\n\t\t\t// inver effect\r\n\t\t\tif(invert !== oldInvert) {\r\n\t\t\t\tif(seInvert.currentTime) {\r\n\t\t\t\t\tseInvert.pause();\r\n\t\t\t\t\tseInvert.currentTime = 0;\r\n\t\t\t\t}\r\n\t\t\t\tseInvert.play();\r\n\r\n\t\t\t\td\r\n\t\t\t\t .alpha(0.5)\r\n\t\t\t\t .drawImage(d, [0.2, 0.2])\r\n\t\t\t\t .alpha(1)\r\n\t\t\t\t;\r\n\t\t\t}\r\n\t\t\toldInvert = invert;\r\n\r\n\t\t};\r\n\t\twindow.setInterval(main, 33);\r\n\t})();\r\n\r\n\r\n})();"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/l/t/M/ltM9_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/l/t/M/ltM9.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/l/t/M/ltM9_100.jpg"},"description_html":"<p>顔文字でもアスキーアートでもない何か <br />\n音あり</p>\n\n<h2>使用素材</h2>\n\n<p><a href=\"http://otosozai.web.fc2.com/index.html\">音処</a> <br />\n<a href=\"http://sfx-g.net/index.html\">効果音G</a>  </p>\n\n<h2>参考文献</h2>\n\n<p><img alt=\"具象化鏡\" src=\"http://dl.dropbox.com/u/3589634/resource/image/gusyokakyo.jpg\" /></p>\n","modified_date":"2013-01-27 21:56:09","uid":"ltM9","created_date":"2013-01-23 21:01:32","path":"ltM9","description":"顔文字でもアスキーアートでもない何か  \r\n音あり\r\n\r\n## 使用素材\r\n[音処](http://otosozai.web.fc2.com/index.html)  \r\n[効果音G](http://sfx-g.net/index.html)  \r\n\r\n## 参考文献\r\n![具象化鏡](http://dl.dropbox.com/u/3589634/resource/image/gusyokakyo.jpg)","statistic":{"forked":"2","favorite":"3","pageview":"2571"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/ltM9","title":"paralell fragment rain"}