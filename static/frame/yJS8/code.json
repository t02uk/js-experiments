{"source":{"css":"body { background-color: #000000; margin: 0px; overflow: hidden; }","html":"<canvas id='world'></canvas>","lisence":"MIT","js":"// sorry but this script may contain many poor engRish\n\n\nvar timeline = \n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000100000000000100010000000000010001000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"1000000000000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000000000000000100000000000000010001000\" +\n\"0000000010000000000000001000100000000000100010000000000010001000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000000000001000100000000000100010000000000010001000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"0000000010000000100000001000000010000000100000000000000010000000\" +\n\"0000000010000000000000001000000000000000100000000000000010000000\" +\n\"1000000010000000000000000000000000000000000000000000000000000000\" +\n\"1000000010000000100000001000000010000000100000001000000010000000\" +\n\"1000000010002000300000003000200030002000300020003000000030002000\" +\n\"1000000010000000100000001000000010000000100000001000000010000000\" +\n\"1000000010002000300000003000300030002000300030003000000030003000\" +\n\"1000000010000000100000001000000010000000100000001000000010000000\" +\n\"1000000010002000300000003000200030002000300020002000000030002000\" +\n\"1000000010000000100000001000000010000000100000001000000010000000\" +\n\"1000000010002000300000003000300030002000300020000000000030002000\" +\n\"1000000000000000100000000000000010000000000000001000000010000000\" +\n\"1000000000002000300000002000200030002000200020003000000030002000\" +\n\"1000000000000000100000000000000010000000000000001000000000000000\" +\n\"1000000000002000300000002000300030002000200030003000000030003000\" +\n\"1000000000000000100000000000000010000000000000001000000010000000\" +\n\"0000000010002000200000003000200020002000300020002000000030002000\" +\n\"1000000000000000100000000000000010000000100000001000000000000000\" +\n\"3000000010002000300000003000300030002000200030003000000030003000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000002000200000002000200020002000200020002000000020002000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000002000200000002000200020002000200020002000000020002000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000002000200000002000200020002000200020002000000020002000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"2000000000000000000000000000000020000000000000000000000000000000\" +\n\"3000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000010001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000000000000000000000000020000000000000000000000000001000\" +\n\"3000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000010001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000001000100010000000000010001000000010001000\" +\n\"1000000010000000100000001000000010000000100000001000000010000000\" +\n\"1000000010000000100000001000000010000000100000000000000010000000\" +\n\"1000000010000000100000001000000010000000100000001000000010000000\" +\n\"1000000010000000100000001000100010000000100010001000000010001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000001000100000000000100010000000000010001000100010001000\" +\n\"1000000010001000100000001000100030001000100010001000100010001000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000003000300000002000300030002000200030003000000020003000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000003000300000002000300030002000200030003000000020003000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000003000300000002000300030002000200030003000000020003000\" +\n\"1000000000001000100000000000100010000000000010001000000000001000\" +\n\"1000000000003000300000002000300030002000200030003000000020003000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000002000200000002000200020002000200020002000000020002000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000002000200000002000200020002000200020002000000020002000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\" +\n\"0000000000000000000000000000000000000000000000000000000000000000\"\n;\n\n\nwindow.onload = function() {\n\n\n  var d = new DCore();\n\n  jQuery.noConflict();\n  var $j = jQuery;\n\n  // load video\n  var media = $j(\"<video>\")\n    .attr(\"src\", \"http://dl.dropbox.com/u/3589634/resource/movie/spectrum.mp4\")\n    .attr(\"autoplay\", true)\n    .hide()\n\n  // setting for video\n  var vw = 256;\n  var vh = 256;\n  var bpm = 138;\n  var ratio = vh / vw;\n  var canplay = false;\n  media[0].addEventListener(\"canplay\", function(e) {\n    canplay = true;\n  });\n  $j(\"#outer\").append(media);\n  media[0].width = vw;\n  media[0].height = vh;\n\n  function Cube() {\n\n    // construct points\n    var ps = [];\n    ps = $R(0, 4, true).map(function(e) {\n      return [1, 1, 1].rotatez(e.toRadian() * 0.25);\n    });\n    ps = ps.concat(ps.scale([1, 1, -1]));\n    this.ps = ps;\n\n    // construct faces\n    var faces = [\n      // near\n      [ps[0], ps[1], ps[2], ps[3]],\n      // far\n      [ps[6], ps[5], ps[4], ps[7]],\n      // left\n      [ps[0], ps[3], ps[7], ps[4]],\n      // right\n      [ps[6], ps[2], ps[1], ps[5]],\n      // top\n      [ps[1], ps[0], ps[4], ps[5]],\n      // bottom\n      [ps[6], ps[7], ps[3], ps[2]],\n    ];\n\n    // rotate\n    faces = faces.map(function(e){return e.invoke(\"rotatea\", 0.8, [1, 0, 1]);});\n    var bottomVertex = faces.shallowFlatten().sortBy(function(e) {\n      return e[1];\n    }).first();\n    faces = faces.invoke(\"translate\", [0, -bottomVertex[1], 0]);\n    this.faces = faces;\n    this.bottomVertex = bottomVertex;\n\n    this.scale = 1;\n    this.blightness = 1;\n\n  };\n  Cube.prototype = {\n    act: function() {\n      this.scale *= 0.8;\n      this.scale += 0.2;\n      this.blightness *= 0.9;\n      this.blightness += 0.1;\n    },\n    beat: function() {\n      this.scale += 0.1;\n    },\n    shine: function() {\n      this.blightness += 0.2;\n    },\n    draw: function() {\n      var self = this;\n      var s = this.scale;\n      var faces = this.faces.invoke(\"scale\", s.arize(3));\n\n      // first, reflection\n      faces.invoke(\"scale\", [1, -1, 1]).zipWithIndex(function(e, i) {\n\n        var a = d.toWorld2dParallel(e);\n        // in back of camera\n        if(!a) return false;\n        // background face culling\n        if(a[2].sub(a[1]).cross(a[1].sub(a[0])) <= 0) return false;\n\n        // draw\n        d\n         .blend(\"source-over\")\n         .alpha(0.3)\n         .rgb(0x66, 0x66, 0x66)\n         .quads(e)\n         .lineWidth(0.01)\n         .stroke()\n        ;\n\n        d.transformTo(Geo.rect(), e, function(d) {\n          d.drawImage(media[0]);\n        });\n      })\n\n      // second, shaddow\n      faces.invoke(\"scale\", [1, 0, 1]).zipWithIndex(function(e, i) {\n        d.hsv(0.7, 0.8, 0.6 + (self.blightness - 1))\n         .blend(\"source-over\")\n         .alpha(0.1)\n         .quads(e)\n         .fill();\n      });\n\n      // and face\n      faces.zipWithIndex(function(e, i) {\n\n        var a = d.toWorld2dParallel(e);\n        // in back of camera\n        if(!a) return false;\n        // background face culling\n        if(a[1].sub(a[0]).cross(a[2].sub(a[1])) <= 0) return false;\n\n        // draw\n        d\n         .blend(\"source-over\")\n         .alpha(0.85)\n         .rgb(0x66, 0x66, 0x66)\n         .quads(e)\n         .lineWidth(0.015)\n         .stroke()\n        ;\n\n        d.transformTo(Geo.rect(), e, function(d) {\n          d.drawImage(media[0]);\n        });\n      })\n    }\n  };\n\n\n  var cube = new Cube();\n\n  // here is main loop\n  var preMeasureDet = 0;\n  (function(c) {\n\n    if(!canplay) {\n      // fillback\n      d\n       .rgb(0xff, 0xff, 0xff)\n       .fillBack()\n      ;\n\n      var letters = \"loading\";\n      letters.split(\"\").zipWithIndex(function(letter, i) {\n\n        var s = 0.1;\n        var from = Geo.rect().scale([s / 2, s]);\n        var to = Geo.rect().scale([s / 2, s]);\n\n        var rad = (i.toRadian() + c / 8) / letters.length;\n  \n        to = to\n          .translate([0.0, -0.3])\n          .rotate(rad)\n          .translate([0.5, 0.5])\n        ;\n\n        // draw circle\n        d\n         .circle([-s, -0.3 + s / 2].rotate(rad).translate([0.5, 0.5]), s / 4.0)\n         .rgb(0xfa, 0xe8, 0xe8)\n         .fill()\n         .rgb(0xee, 0xcc, 0xee)\n         .stroke()\n        ;\n\n        // draw l o a d i n g\n        d\n         .transformTo(from, to, function(d) {\n           d\n            .font(\"monospace\", s)\n            .textAlign(\"top\")\n            .textBaseline(\"left\")\n            .rgb(0xd3, 0x6d, 0xdd)\n            .fillText(letter, [0, 0])\n           ;\n         });\n        ;\n      });\n\n    } else {\n\n      // ground, sky\n      d\n       .blend(\"source-over\")\n       .alpha(1.0)\n       .rgb(0xd3, 0xd6, 0xdd)\n       .fillBack()\n       .rgb(0xbb, 0xbb, 0xcc)\n       .quads(Geo.rect().scale([1, 0.4]))\n       .fill()\n      ;\n\n      // sky\n\n      // set camera\n      d.gazeFrom(\n        [0, 4, 6].rotatey(c/100),\n        [cube.bottomVertex[0], 2.5, cube.bottomVertex[2]],\n        [0, 1, 0]\n      );\n\n      // caluculate current measure\n      var time = media[0].currentTime - 1.723;\n      var measureDet = ~~(bpm / 60 / 4 * time * 64);\n\n      // measureDet changed\n      if(time > 0 && measureDet !== preMeasureDet) {\n        var s = timeline.substring(preMeasureDet, measureDet);\n\n        // kick\n        if(s.match(/(1|3)/)) {\n          cube.beat();\n        }\n        // tyaka\n        if(s.match(/(2|3)/)) {\n          cube.shine();\n        }\n      }\n      preMeasureDet = measureDet;\n\n      // draw cube\n      cube.act();\n      cube.draw();\n      \n    }\n\n    window.setTimeout(arguments.callee.curry(c+1), 33);\n  })(0);\n\n\n}\n// vim:\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/y/J/S/yJS8_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/y/J/S/yJS8.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/y/J/S/yJS8_100.jpg"},"description_html":"キックの音に躍動するキューブ。<br />\r\n動画を三次元のテクスチャに貼ったり、音と動きを同期させてみたり模索中。<br />\r\n※Chromeでのみ確認。<br />\r\n<br />\r\n元動画(エルリ鳥(uedaさん+O-SEさん) スペクトラム)はこっち。こっちのが見やすい。<br />\r\n<a  href=\"http://zoome.jp/ueda/diary/2\">http://zoome.jp/ueda/diary/2</a><br />\r\n元BMSはこっち。PAGE→MUSIC and BMS→スペクトラム<br />\r\n<a  href=\"http://kaikou.nothing.sh/\">http://kaikou.nothing.sh/</a><br />\r\n<br />\r\n(2012/09/02) 床の反射を修正(見えない奥の面が描かれてた)","modified_date":"2012-09-02 13:30:24","uid":"yJS8","created_date":"2011-02-11 00:07:54","path":"yJS8","description":"キックの音に躍動するキューブ。\r\n動画を三次元のテクスチャに貼ったり、音と動きを同期させてみたり模索中。\r\n※Chromeでのみ確認。\r\n\r\n元動画(エルリ鳥(uedaさん+O-SEさん) スペクトラム)はこっち。こっちのが見やすい。\r\nhttp://zoome.jp/ueda/diary/2\r\n元BMSはこっち。PAGE→MUSIC and BMS→スペクトラム\r\nhttp://kaikou.nothing.sh/\r\n\r\n(2012/09/02) 床の反射を修正(見えない奥の面が描かれてた)","statistic":{"forked":"1","favorite":"14","pageview":"4700"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/yJS8","title":"video on a cube"}