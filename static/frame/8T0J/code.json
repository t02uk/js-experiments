{"source":{"css":"* {\r\n    margin: 0px;\r\n    padding: 0px;\r\n}\r\n\r\nbody {\r\n  overflow: hidden;\r\n}\r\n\r\ncanbas {\r\n    width: 465px;\r\n    height: 465px;\r\n}\r\n\r\nvideo {\r\n    display: hidden;\r\n}","html":"<canvas id=\"world\"></canvas>\r\n<video id=\"video\"></video>","lisence":"MIT","js":"(function() {\r\n\r\n    var SHADOW_SIZE = 256;\r\n    var SHADOW_SIZE_BITS = 7;\r\n    var THREAD_HOLD = 8;\r\n    \r\n    var video = document.getElementById(\"video\");\r\n\r\n    // search bendor prefixed function/method and return found one\r\n    var withVendorPrefix = function(obj, member) {\r\n        return obj[member] || [\"webkit\", \"moz\", \"ms\"].inject(undefined, function(i, e) {\r\n            return i || obj[e + member.replace(/^\\w/, function(x){return x.toUpperCase();})];\r\n        });\r\n    };\r\n\r\n    // setup for filter\r\n    var getUserMedia = withVendorPrefix(navigator, \"getUserMedia\");\r\n    if(!getUserMedia) {\r\n        alert(\"not supported\");\r\n        return;\r\n    }\r\n    getUserMedia.call(navigator, {video:true, toString: function(){return \"video\"}}, function(stream) {\r\n        var URL = withVendorPrefix(window, \"URL\");\r\n        var url = URL.createObjectURL(stream) || stream;\r\n        video.src = url;\r\n        video.play();\r\n        main();\r\n    }, function() {\r\n        alert(\"stream is not available\");\r\n        return;\r\n    });\r\n\r\n    // main routen\r\n    var main = function() {\r\n        var d = new DCore();\r\n        var work = $R(1, 2).map(function() {\r\n            return d\r\n                .subTexture(SHADOW_SIZE, SHADOW_SIZE)\r\n                .rgb(0x00, 0x00, 0x00)\r\n                .fillBack()\r\n            ;\r\n        });\r\n        var workIndex = 0;\r\n\r\n        var shadows = $R(1, 8).map(function() { return d.subTexture(SHADOW_SIZE, SHADOW_SIZE);});\r\n        var shadowIndex = 0;\r\n        \r\n        (function() {\r\n            work[workIndex].drawImage(video);\r\n            var imgA = work[workIndex].getNativeImageData().data;\r\n            var imgB = work[1 - workIndex].getNativeImageData().data;\r\n            var shadow = shadows[shadowIndex];\r\n            var img =  shadow.ctx.createImageData(SHADOW_SIZE, SHADOW_SIZE);\r\n            var imgDest = img.data;\r\n            for(var i = 0, l = SHADOW_SIZE * SHADOW_SIZE * 4; i < l; i += 4) {\r\n                var grayScaledA = (imgA[i] * 19589 + imgA[i + 1] * 38444 + imgA[i + 2] * 7502) >>> 16;\r\n                var grayScaledB = (imgB[i] * 19589 + imgB[i + 1] * 38444 + imgB[i + 2] * 7502) >>> 16;\r\n                var diff = grayScaledA - grayScaledB;\r\n                if(diff < 0) diff = -diff;\r\n                if(diff < THREAD_HOLD) {\r\n                    imgDest[i] = 0x00;\r\n                    imgDest[i + 1] = 0x00;\r\n                    imgDest[i + 2] = 0x00;\r\n                    imgDest[i + 3] = 0x00;\r\n                } else {\r\n                    imgDest[i] = 0x00;\r\n                    imgDest[i + 1] = 0x00;\r\n                    imgDest[i + 2] = 0xff;\r\n                    imgDest[i + 3] = diff * diff >> 4;\r\n                }\r\n            }\r\n            //console.info(putImageData);\r\n            shadow.ctx.putImageData(img, 0, 0);\r\n\r\n            d\r\n             .blend(\"source-over\")\r\n             .alpha(1)\r\n             .rgb(0x00, 0x00, 0x00).fillBack()\r\n             .drawImage(work[workIndex])\r\n            ;\r\n            for(i = 0; i < 8; i++) {\r\n                var k = (shadowIndex - i + 8) % 8;\r\n                d\r\n                 .blend(\"lighter\")\r\n                 .alpha(1 - (i / 8))\r\n                 .drawImage(shadows[k])\r\n                ;\r\n            }\r\n             \r\n            shadowIndex++;\r\n            shadowIndex %= 8;\r\n            workIndex++;\r\n            workIndex %= 2;\r\n            window.setTimeout(arguments.callee, 33);\r\n        })();        \r\n    };\r\n\r\n})();\r\n"},"thumbnail":{"wide":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/8/T/0/8T0J_w.jpg","465":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/8/T/0/8T0J.jpg","100":"http://jsdo-static-contents.s3.amazonaws.com/images/capture/8/T/0/8T0J_100.jpg"},"description_html":"要Webカメラ<br />\r\n確認　Google Chrome 25.0.1364.172 m","modified_date":"2013-03-20 22:04:46","uid":"8T0J","created_date":"2013-03-20 21:57:55","path":"8T0J","description":"要Webカメラ\r\n確認　Google Chrome 25.0.1364.172 m","statistic":{"forked":"1","favorite":"4","pageview":"3213"},"user":{"icon":"http://jsdo-static-contents.s3.amazonaws.com/images/icon/b/4/2/c/b42cc3dd3312505b680411b3ead08e2dbc4192e4_100.jpg","name":"crispy"},"url":"http://jsdo.it/crispy/8T0J","title":"残像カメラ"}